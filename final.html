<!doctype html>
<html lang="en">
    
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="components/scatterplot.js"></script>
    <script src="components/histogram.js"></script>
    <script src="components/datatable.js"></script>
    <script src="components/stackedchart.js"></script>


    <title>My Scatterplot</title>
    <style>
        body {
            background: #eee;
            overflow-y: scroll;
        }

        .container {
            width: 100%;
            background: white;
        }

        /* In the <style> tag in index.html */
        .brushed {
            stroke-width: 1;
            stroke: gray;
            r: 5;
        }
    </style>
</head>

<body>
    <header>
        <nav class="container navbar navbar-light bg-light">
            <div class="container-fluid">
                <span class="navbar-brand mb-0 h1" style="font-size:50px; margin:0 auto;">Information Visualization Final Project</span>
            </div>
            <div class="container-fluid" style="margin:0 auto;">
                <p><a href="#pos1" style="font-size:20px;">문서의 하단 지정 위치로</a></p>
            </div>
        </nav>
        

    </header>

    <main class="container pb-3">
        <div class="row pt-2">
            <div>
                <span class="navbar-brand mb-0 h1" style="font-size:50px; margin:0 auto;" id="pos1">Dataset</span>
            </div>
            <div class="col-1 text-end pe-2"><strong>X:</strong></div>
            <div class="col-11">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="x-encoding" value="ram_gb" id="x-sl"
                        checked>
                    <label class="form-check-label" for="x-sl">ram_gb</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="x-encoding" value="ssd" id="x-sw">
                    <label class="form-check-label" for="x-sw">ssd</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="x-encoding" value="hdd" id="x-pl">
                    <label class="form-check-label" for="x-pl">hdd</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="x-encoding" value="os_bit" id="x-pw">
                    <label class="form-check-label" for="x-pw">os_bit</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="x-encoding" value="graphic_card_gb" id="x-pw">
                    <label class="form-check-label" for="x-pw">graphic_card_gb</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="x-encoding" value="display_size" id="x-pw">
                    <label class="form-check-label" for="x-pw">display_size</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="x-encoding" value="warranty" id="x-pw">
                    <label class="form-check-label" for="x-pw">warranty</label>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-1 text-end pe-2"><strong>Y:</strong></div>
            <div class="col-11">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y-encoding" value="latest_price" id="y-sl">
                    <label class="form-check-label" for="y-sl">latest_price</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y-encoding" value="old_price" id="y-sw"
                        checked>
                    <label class="form-check-label" for="y-sw">old_price</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y-encoding" value="discount" id="y-pl">
                    <label class="form-check-label" for="y-pl">discount</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y-encoding" value="star_rating" id="y-pw">
                    <label class="form-check-label" for="y-pw">star_rating</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y-encoding" value="ratings" id="y-pw">
                    <label class="form-check-label" for="y-pw">ratings</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y-encoding" value="reviews" id="y-pw">
                    <label class="form-check-label" for="y-pw">reviews</label>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col offset-1">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="use-color" checked>
                    <label class="form-check-label" for="use-color">Color-encode Class</label>
                </div>
            </div>
        </div>
        <div class="text-center">
            <svg width="800" height="800" id="scatterplot">
            </svg>

            <svg width="800" height="800" id="histogram">
            </svg>
        </div>
        
        <div class="row pt-2">
            <div class="col-1 text-end pe-2"><strong>Brand:</strong></div>
            <div class="col-11">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="for-brand[]" value="ASUS" id="checkbox"
                        checked>
                    <label class="form-check-label" for="x-sl">ASUS</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="for-brand[]" value="HP" id="checkbox" checked>
                    <label class="form-check-label" for="x-sw">HP</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="for-brand[]" value="Lenovo" id="checkbox" checked>
                    <label class="form-check-label" for="x-pl">Lenovo</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="for-brand[]" value="DELL" id="checkbox" checked>
                    <label class="form-check-label" for="x-pw">DELL</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="for-brand[]" value="MSI" id="checkbox" checked>
                    <label class="form-check-label" for="x-pw">MSI</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="for-brand[]" value="realme" id="checkbox" checked>
                    <label class="form-check-label" for="x-pw">realme</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="for-brand[]" value="acer" id="checkbox" checked>
                    <label class="form-check-label" for="x-pw">acer</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="for-brand[]" value="RedmiBook" id="checkbox" checked>
                    <label class="form-check-label" for="x-pw">RedmiBook</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="for-brand[]" value="Nokia" id="checkbox" checked>
                    <label class="form-check-label" for="x-pw">Nokia</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="for-brand[]" value="Infinix" id="checkbox" checked>
                    <label class="form-check-label" for="x-pw">Infinix</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="for-brand[]" value="Mi" id="checkbox" checked>
                    <label class="form-check-label" for="x-pw">Mi</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="for-brand[]" value="APPLE" id="checkbox" checked>
                    <label class="form-check-label" for="x-pw">APPLE</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="for-brand[]" value="MICROSOFT" id="checkbox" checked>
                    <label class="form-check-label" for="x-pw">MICROSOFT</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="for-brand[]" value="LG" id="checkbox" checked>
                    <label class="form-check-label" for="x-pw">LG</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="for-brand[]" value="Vaio" id="checkbox" checked>
                    <label class="form-check-label" for="x-pw">Vaio</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="for-brand[]" value="Smartron" id="checkbox" checked>
                    <label class="form-check-label" for="x-pw">Smartron</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="for-brand[]" value="Avita" id="checkbox" checked>
                    <label class="form-check-label" for="x-pw">Avita</label>
                </div>
            </div>
        </div>
        <div class="row pt-2">
            <div class="col-1 text-end pe-2"><strong>Feature:</strong></div>
            <div class="col-11">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="feature" value="processor_brand" id="checkbox"
                        checked>
                    <label class="form-check-label" for="x-sl">processor_brand</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="feature" value="processor_name" id="checkbox">
                    <label class="form-check-label" for="x-sw">processor_name</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="feature" value="processor_gnrtn" id="checkbox">
                    <label class="form-check-label" for="x-pl">processor_gnrtn</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="feature" value="ram_gb" id="checkbox">
                    <label class="form-check-label" for="x-pw">ram_gb</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="feature" value="ram_type" id="checkbox">
                    <label class="form-check-label" for="x-pw">ram_type</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="feature" value="ssd" id="checkbox">
                    <label class="form-check-label" for="x-pw">ssd</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="feature" value="hdd" id="checkbox">
                    <label class="form-check-label" for="x-pw">hdd</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="feature" value="os" id="checkbox">
                    <label class="form-check-label" for="x-pw">os</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="feature" value="os_bit" id="checkbox">
                    <label class="form-check-label" for="x-pw">os_bit</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="feature" value="weight" id="checkbox">
                    <label class="form-check-label" for="x-pw">weight</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="feature" value="display_size" id="checkbox">
                    <label class="form-check-label" for="x-pw">display_size</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="feature" value="warranty" id="checkbox">
                    <label class="form-check-label" for="x-pw">warranty</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="feature" value="Touchscreen" id="checkbox">
                    <label class="form-check-label" for="x-pw">Touchscreen</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="feature" value="msoffice" id="checkbox">
                    <label class="form-check-label" for="x-pw">msoffice</label>
                </div>
            </div>
        </div>

        <!-- Create a div where the graph will take place -->
        <div id="my_dataviz"></div>

        <div class="row">
            <div class="col-1 text-end pe-2"><strong>Criteria:</strong></div>
            <div class="col-11">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="price[]" value="latest_price" id="prices" checked>
                    <label class="form-check-label" for="y-sl">latest_price</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="price[]" value="old_price" id="prices"
                        checked>
                    <label class="form-check-label" for="y-sw">old_price</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="price[]" value="discount" id="prices" checked>
                    <label class="form-check-label" for="y-pl">discount</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="price[]" value="star_rating" id="prices" checked>
                    <label class="form-check-label" for="y-pw">star_rating</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="price[]" value="ratings" id="prices" checked>
                    <label class="form-check-label" for="y-pw">ratings</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="price[]" value="reviews" id="prices" checked>
                    <label class="form-check-label" for="y-pw">reviews</label>
                </div>
            </div>
        </div>

        <!-- Create a div where the graph will take place -->
        <div id="line_graph"></div>
        <div class="row">
            <div class="col-1 text-end pe-2"><strong>Filtering : </strong></div>
            <div class="col-11" id="filtering_data">
                
            </div>
        </div>

        <table class="table table-striped text-center"  style="font-size:10px;">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>brand</th>
                    <th>model</th>
                    <th>processor brand</th>
                    <th>processor name</th>
                    <th>processor gnrtn</th>
                    <th>ram gb</th>
                    <th>ram type</th>
                    <th>ssd</th>
                    <th>hdd</th>
                    <th>os</th>
                    <th>os bit</th>
                    <th>graphic card gb</th>
                    <th>weight</th>
                    <th>display size</th>
                    <th>warranty</th>
                    <th>Touch screen</th>
                    <th>msoffice</th>
                    <th>latest price</th>
                    <th>old price</th>
                    <th>discount</th>
                    <th>star rating</th>
                    <th>ratings</th>
                    <th>reviews</th>
                </tr>
            </thead>
            <tbody id="data-table">

            </tbody>
        </table>
    </main>

    <script>
        let data, brushedData, scatterplot, histogram, dataTable, width, height;

        function updateScatterplot() {
            let xVar = d3.select("input[type=radio][name=x-encoding]:checked").property("value");
            let yVar = d3.select("input[type=radio][name=y-encoding]:checked").property("value");
            let useColor = d3.select("#use-color").property("checked");

            // TODO: update the scatterplot by calling scatterplot.update 
            scatterplot.update(xVar, yVar, "brand", useColor);
        }

        function updateHistogram() {
            histogram.update(brushedData && brushedData.length > 0 ? brushedData : data, "brand");
        }

        function settings(){
            const element = document.getElementById('filtering_data');
            const skip = ['ID', 'latest_price', 'old_price', 'discount', 'star_rating', 'ratings', 'reviews']
            for (var key in data[0]){
                if(skip.includes(key)) {continue}
                element.innerHTML += '<div class="form-check form-check-inline">'+key+':<select id="'+key+'_filter"></select></div>';
                const categories = [...new Set(data.map(d => d[key]))]
                const element2 = document.getElementById(key+'_filter');
                cnt = 0;
                element2.innerHTML += '<option value="All">All</option>';
                categories.forEach((x) =>{
                    element2.innerHTML += '<option value="'+x+'">'+x+'</option>';
                })
                console.log(key);

                // d3.selectAll("#"+key+"_filter").on("change", updateDataTable);
            }

        }

        function updateDataTable() {
            compare_set = {}
            const skip = ['ID', 'latest_price', 'old_price', 'discount', 'star_rating', 'ratings', 'reviews']
            for (var key in data[0]){
                if(skip.includes(key)) {continue}
                compare_set[key] = d3.select("#"+key+"_filter").node().value;
            }
            // let brand_val = d3.select("#brand_filter").node().value;
            dataset = []
            console.log(compare_set)
            console.log(String(data[0]['ID']))
            
            data.forEach((x) => {
                check = 0;
                for(key in compare_set){
                    if(compare_set[key] === 'All'){
                        check ++;
                        continue;
                    }
                    else if(String(x[key]) === compare_set[key]){
                        check++
                    }
                }
                if(check === 17){
                    dataset.push(x)
                }
                // console.log(dataset)
                // if(x['brand'] === brand_val){
                //     dataset.push(x)
                // }
            })

            dataTable.update(dataset, data.columns)
        }

        function updateStackedchart() {
            d3.select("#the_SVG_ID").remove();
            const margin = {top: 10, right: 100, bottom: 40, left: 90},
                width = 1000,
                height = 400;

            // append the svg object to the body of the page
            const svg = d3.select("#my_dataviz")
                .append("svg")
                .attr("id","the_SVG_ID")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // const brand_set = d3.select("input[type=checkbox][name=for-brand[]]:checked").property("value");
            var check = document.getElementsByName("for-brand[]");
            var check2 = d3.select("input[type=radio][name=feature]:checked").property("value");
            const brand_set = []
            for(var i=0;i<check.length;i++){
                if(check[i].checked == true) {
                    brand_set.push(check[i].value)
                }
            }
            
            const brands = data.map(d => (d.brand))
            for(let i = 0; i < brands.length; i++) {
                if(!brand_set.includes(brands[i]))  {
                    brands[i] = undefined
                }
            }
            delete brands.empty;
            // console.log(check2)
            const datas = data.map(d => (d[check2]))
            const result = {};
            for(let i = 0; i < brands.length; i++){
                if(result[brands[i]]) {
                    if(result[brands[i]][datas[i]]) {
                        result[brands[i]][datas[i]] = result[brands[i]][datas[i]] + 1;
                    }else {
                        result[brands[i]][datas[i]] = 0 + 1;
                    }
                }else {
                    if(brand_set.includes(brands[i])){
                        result[brands[i]] = {};
                        if(result[brands[i]][datas[i]]) {
                            result[brands[i]][datas[i]] = result[brands[i]][datas[i]] + 1;
                        }else {
                            result[brands[i]][datas[i]] = 0 + 1;
                        }
                    }
                }
            }
            const datas_set = []
            datas.forEach((x) => { 
                if(!datas_set.includes(x)){
                    datas_set.push(x)
                }
            });

            // const brand_set = []
            // brands.forEach((x) => { 
            //     if(!brand_set.includes(x)){
            //         brand_set.push(x)
            //     }
            // });
            // datas_set.unshift('brand')
            
            const result_csv = []

            for(var key in result){
                const cnt = {}
                cnt['bran'] = key
                datas_set.forEach((x) => {
                    cnt[x] = 0
                })
                for(var key2 in result[key]){
                    cnt[key2] += result[key][key2]
                }
                result_csv.push(cnt)
            }
            // console.log(datas_set)
            
            // // List of subgroups = header of the csv files = soil condition here
            // const subgroups = datas_set

            // // List of groups = species here = value of the first column called group -> I show them on the X axis
            // const groups = data.map(d => (d.brand))
            
            // Add X axis
            const x = d3.scaleBand()
                .domain(brand_set)
                .range([0, width])
                .padding([0.2])
            svg.append("g")
                .attr("transform", `translate(0, ${height})`)
                .call(d3.axisBottom(x).tickSizeOuter(0));
                
            // Add Y axis
            const y = d3.scaleLinear()
                .domain([0, 200])
                .range([ height, 0 ]);
            svg.append("g")
                .call(d3.axisLeft(y));
                
            // color palette = one color per subgroup
            const color = d3.scaleOrdinal()
                .domain(datas_set)
                .range(d3.schemeCategory10)
                
            const legend = svg.append("g")
                .attr("transform", `translate(${width + 10}, ${margin.top})`)
                .call(d3.legendColor().scale(color))

            //stack the data? --> stack per subgroup
            const stackedData = d3.stack().keys(datas_set)(result_csv)
                
            // console.log(stackedData)
            
            // Show the bars
            svg.append("g")
                .selectAll("g")
                // Enter in the stack data = loop key per key = group per group
                .data(stackedData)
                .join("g")
                    .attr("fill", d => color(d.key))
                    .attr("class", d => "myRect a" + datas_set.findIndex(v => v === d.key) )
                    .selectAll("rect")
                    // enter a second time = loop subgroup per subgroup to add all rectangles
                    .data(d => d)
                    .join("rect")
                        .attr("x", d => x(d.data.bran))
                        .attr("y", d => y(d[1]))
                        .attr("height", d => y(d[0]) - y(d[1]))
                        .attr("width",x.bandwidth())

                        .attr("stroke", "grey")
                        .on("mouseover", function (event,d) { // What happens when user hover a bar
                            
                            // what subgroup are we hovering?
                            const subGroupName = d3.select(this.parentNode).datum().key
                            // console.log(subGroupName)
                            // Reduce opacity of all rect to 0.2
                            d3.selectAll(".myRect").style("opacity", 0.2)
                            const query = "a" + datas_set.findIndex(v => v === subGroupName)
                            // Highlight all rects of this subgroup with opacity 1. It is possible to select them since they have a specific class = their name.
                            d3.selectAll("."+query).style("opacity",1)
                        })
                        .on("mouseleave", function (event,d) { // When user do not hover anymore

                            // Back to normal opacity: 1
                            d3.selectAll(".myRect")
                            .style("opacity",1)
                    })
        }

        function updateLinechart(){
            d3.select("#the_price").remove();
            var check = document.getElementsByName("price[]");
            // var check2 = d3.select("input[type=radio][name=feature]:checked").property("value");
            const criteria_tmp = ['latest_price', 'old_price', 'discount', 'star_rating', 'ratings', 'reviews']
            const criteria = []
            for(var i=0;i<check.length;i++){
                if(check[i].checked == true) {
                    criteria.push(check[i].value)
                }
            }

            const margin = {top: 10, right: 100, bottom: 40, left: 90},
                width = 1000,
                height = 400;

            // append the svg object to the body of the page
            const svg = d3.select("#line_graph")
                .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .attr("id","the_price")
                .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

            
            // group the data: I want to draw one line per group
            const categories = [...new Set(data.map(d => d['brand']))]
            const sumstat = d3.group(data, d => d.brand); // nest function allows to group the calculation per level of a factor
            const stat_mean = [];
            console.log(sumstat)
            criteria.forEach(c => {
                categories.forEach(p => {
                    let crit_mean = {};
                    const cnt_data = data.filter(d => d['brand'] === p);
                    const cnt_data2 = cnt_data.map(d => d[c]);
                    crit_mean['brand'] = p;
                    crit_mean['mean'] = d3.mean(cnt_data2);
                    // crit_mean[p] = d3.mean(cnt_data2);
                    crit_mean['crit'] = c;
                    // console.log(crit_mean);
                    stat_mean.push(crit_mean);
                })
            })
            console.log(stat_mean)
            const result = d3.rollup(
                stat_mean,
                values => values,
                d => d.crit
            )
            
            // Add X axis --> it is a date format
            const x = d3.scaleBand()
                .domain(categories)
                .range([ 0, width ]);
            svg.append("g")
                .attr("transform", `translate(0, ${height})`)
                .call(d3.axisBottom(x).tickSizeOuter(0));

            // Add Y axis
            const y = d3.scaleLinear()
                .domain([0, d3.max(stat_mean, function(d) { return d.mean; })])
                .range([ height, 0 ]);
            svg.append("g")
                .call(d3.axisLeft(y));
                
                // color palette
            const color = d3.scaleOrdinal()
                .domain(criteria_tmp)
                .range(['#e41a1c','#377eb8','#4daf4a','#984ea3','#ff7f00','#ffff33','#a65628','#f781bf','#999999'])

            const legend = svg.append("g")
                .attr("transform", `translate(${width + 10}, ${margin.top})`)
                .call(d3.legendColor().scale(color))
                
            // // create a tooltip
            // var Tooltip = d3.select("#line_graph")
            //     .append("div")
            //     .style("opacity", 0)
            //     .attr("class", "tooltip")
            //     .style("background-color", "white")
            //     .style("border", "solid")
            //     .style("border-width", "2px")
            //     .style("border-radius", "5px")
            //     .style("padding", "5px")

            // console.log(result)
            // Draw the line
            svg.selectAll(".line")
                .data(result)
                .join("path")
                    .attr("fill", "none")
                    .attr("stroke", function(d){console.log(color(d[0])); return color(criteria_tmp.findIndex(v => v === d[0]));})
                    .attr("stroke-width", 1.5)
                    .attr("d", function(d){
                            
                        return d3.line()
                            .x(function(d) { return x(d.brand); })
                            .y(function(d) { return y(d.mean); })
                            (d[1])
                    })
        }


        d3.csv("https://raw.githubusercontent.com/CheshireCat0430/Information_Visualization/master/Cleaned_Laptop_data_filtering.csv")
            .then(csvData => {
                csvData.forEach(d => {
                    d["ram_gb"] = +d["ram_gb"];
                    d["ssd"] = +d["ssd"];
                    d["hdd"] = +d["hdd"];
                    d["os_bit"] = +d["os_bit"];
                    d["graphic_card_gb"] = +d["graphic_card_gb"];
                    d["display_size"] = +d["display_size"];
                    d["warranty"] = +d["warranty"];
                    d["latest_price"] = +d["latest_price"];
                    d["old_price"] = +d["old_price"];
                    d["discount"] = +d["discount"];
                    d["star_rating"] = +d["star_rating"];
                    d["ratings"] = +d["ratings"];
                    d["reviews"] = +d["reviews"];
                });

                data = csvData;

                scatterplot = new Scatterplot("#scatterplot", data);
                scatterplot.initialize();

                updateScatterplot();
                d3.selectAll("input[type=radio][name=x-encoding]").on("change", updateScatterplot);
                d3.selectAll("input[type=radio][name=y-encoding]").on("change", updateScatterplot);
                d3.selectAll("#use-color").on("change", updateScatterplot);

                
                // TODO: bind an event handler to "brush" events                
                scatterplot.on("brush", (brushedItems) => {
                    brushedData = brushedItems;
                    updateHistogram();
                    updateDataTable();
                });

                histogram = new Histogram("#histogram");
                histogram.initialize();

                updateHistogram();
                
                dataTable = new DataTable("#data-table");
                settings();
                updateDataTable();

                updateStackedchart()
                d3.selectAll("#checkbox").on("change", updateStackedchart);

                for (var key in data[0]){
                    d3.selectAll("#"+key+"_filter").on("change", updateDataTable);
                }
            })

        // set the dimensions and margins of the graph
        // const margin = {top: 10, right: 30, bottom: 30, left: 60};
        // width = 1000 - margin.left - margin.right;
        // height = 400 - margin.top - margin.bottom;

        // // append the svg object to the body of the page
        // const svg = d3.select("#line_graph")
        //     .append("svg")
        //         .attr("width", width + margin.left + margin.right)
        //         .attr("height", height + margin.top + margin.bottom)
        //     .append("g")
        //         .attr("transform", `translate(${margin.left},${margin.top})`);
        

        // Parse the Data
        d3.csv("https://raw.githubusercontent.com/CheshireCat0430/Information_Visualization/master/Cleaned_Laptop_data_filtering.csv").then( function(data) {
            updateLinechart();
            d3.selectAll("#prices").on("change", updateLinechart);
            // const criteria = ['latest_price', 'old_price', 'discount', 'star_rating', 'ratings', 'reviews']
            
            // // group the data: I want to draw one line per group
            // const categories = [...new Set(data.map(d => d['brand']))]
            // const sumstat = d3.group(data, d => d.brand); // nest function allows to group the calculation per level of a factor
            // const stat_mean = [];
            // console.log(sumstat)
            // criteria.forEach(c => {
            //     categories.forEach(p => {
            //         let crit_mean = {};
            //         const cnt_data = data.filter(d => d['brand'] === p);
            //         const cnt_data2 = cnt_data.map(d => d[c]);
            //         crit_mean['brand'] = p;
            //         crit_mean['mean'] = d3.mean(cnt_data2);
            //         // crit_mean[p] = d3.mean(cnt_data2);
            //         crit_mean['crit'] = c;
            //         // console.log(crit_mean);
            //         stat_mean.push(crit_mean);
            //     })
            // })
            // console.log(stat_mean)
            // const result = d3.rollup(
            //     stat_mean,
            //     values => values,
            //     d => d.crit
            // )
            
            // // Add X axis --> it is a date format
            // const x = d3.scaleBand()
            //     .domain(categories)
            //     .range([ 0, width ]);
            // svg.append("g")
            //     .attr("transform", `translate(0, ${height})`)
            //     .call(d3.axisBottom(x).tickSizeOuter(0));

            // // Add Y axis
            // const y = d3.scaleLinear()
            //     .domain([0, d3.max(stat_mean, function(d) { return d.mean; })])
            //     .range([ height, 0 ]);
            // svg.append("g")
            //     .call(d3.axisLeft(y));
                
            //     // color palette
            // const color = d3.scaleOrdinal()
            //     .range(['#e41a1c','#377eb8','#4daf4a','#984ea3','#ff7f00','#ffff33','#a65628','#f781bf','#999999'])
                
            // console.log(result)
            // // Draw the line
            // svg.selectAll(".line")
            //     .data(result)
            //     .join("path")
            //         .attr("fill", "none")
            //         .attr("stroke", function(d){return color(criteria.findIndex(v => v === d[0]));})
            //         .attr("stroke-width", 1.5)
            //         .attr("d", function(d){
                            
            //             return d3.line()
            //                 .x(function(d) { return x(d.brand); })
            //                 .y(function(d) { return y(d.mean); })
            //                 (d[1])
            //         })

        })

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
</body>

</html>